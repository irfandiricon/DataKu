DELIMITER $$
CREATE
    TRIGGER `pusb8564_dataku`.`AI_TRANSAKSI` AFTER INSERT
    ON `pusb8564_dataku`.`TRANSAKSI`
    FOR EACH ROW BEGIN
	SET @vEmail = NEW.CREATED_BY;
	SET @vType = (SELECT TYPE FROM V_TRANSAKSI WHERE ID_REFFERENCE = NEW.ID_REFFERENCE);
	SET @vStatus = (SELECT ERROR_MESSAGE FROM V_TRANSAKSI WHERE ID_REFFERENCE = NEW.ID_REFFERENCE);
	SET @vTitle = CONCAT_WS(' ','Transaksi',LOWER(@vType));
	SET @vDesc = CONCAT_WS(' ','Transaksi',NEW.NO_PELANGGAN,'(',@vStatus,')');
	INSERT INTO MS_NOTIFICATION (EMAIL,TITLE,DESCRIPTION,CREATED_DATE) VALUES (@vEmail,@vTitle,@vDesc,NOW());
    END$$
DELIMITER ;