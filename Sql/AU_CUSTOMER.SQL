DELIMITER $$

USE `pusb8564_dataku`$$

DROP TRIGGER /*!50032 IF EXISTS */ `AU_CUSTOMER`$$

CREATE
    TRIGGER `AU_CUSTOMER` AFTER UPDATE ON `CUSTOMER` 
    FOR EACH ROW BEGIN
	SET @vOldEmail = OLD.EMAIL;
	SET @vNewEmail = NEW.EMAIL;
	IF @vOldEmail != @vNewEmail THEN
		UPDATE TRANSAKSI SET CREATED_BY = @vNewEmail WHERE ID IN (SELECT ID FROM TRANSAKSI WHERE CREATED_BY = @vOldEmail);
		UPDATE CUSTOMER_DEPOSITE SET EMAIL = @vNewEmail WHERE ID IN (SELECT ID FROM CUSTOMER_DEPOSITE WHERE EMAIL = @vOldEmail);
	END IF;
    END;
$$

DELIMITER ;